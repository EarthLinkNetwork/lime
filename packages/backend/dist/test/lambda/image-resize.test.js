"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock S3 Client
const mockSend = jest.fn();
jest.mock('@aws-sdk/client-s3', () => ({
    S3Client: jest.fn().mockImplementation(() => ({
        send: mockSend,
    })),
    GetObjectCommand: jest.fn().mockImplementation((params) => params),
}));
// Mock sharp
const mockSharpInstance = {
    resize: jest.fn().mockReturnThis(),
    webp: jest.fn().mockReturnThis(),
    png: jest.fn().mockReturnThis(),
    jpeg: jest.fn().mockReturnThis(),
    composite: jest.fn().mockReturnThis(),
    toBuffer: jest.fn().mockResolvedValue(Buffer.from('resized-image-data')),
    metadata: jest.fn().mockResolvedValue({ width: 1920, height: 1080 }),
};
jest.mock('sharp', () => {
    return jest.fn().mockImplementation(() => mockSharpInstance);
});
// Set env before importing handler
process.env.BUCKET_NAME = 'test-bucket';
// Import handler after mocks
const index_1 = require("../../lambda/image-resize/index");
describe('Image Resize Lambda', () => {
    const createEvent = (overrides = {}) => ({
        version: '2.0',
        routeKey: 'GET /{proxy+}',
        rawPath: '/uploads/test-image.jpg',
        rawQueryString: 'w=100',
        headers: {},
        queryStringParameters: {
            w: '100',
        },
        pathParameters: {
            proxy: 'uploads/test-image.jpg',
        },
        requestContext: {
            accountId: '123456789012',
            apiId: 'test-api-id',
            domainName: 'test.cloudfront.net',
            domainPrefix: 'test',
            http: {
                method: 'GET',
                path: '/uploads/test-image.jpg',
                protocol: 'HTTP/1.1',
                sourceIp: '127.0.0.1',
                userAgent: 'test-agent',
            },
            requestId: 'test-request-id',
            routeKey: 'GET /{proxy+}',
            stage: '$default',
            time: '01/Jan/2024:00:00:00 +0000',
            timeEpoch: 1704067200000,
        },
        isBase64Encoded: false,
        ...overrides,
    });
    // Helper to create a readable stream from buffer
    const createMockStream = (data) => {
        const { Readable } = require('stream');
        return Readable.from([data]);
    };
    beforeEach(() => {
        jest.clearAllMocks();
        // Reset mock S3 response
        mockSend.mockResolvedValue({
            Body: createMockStream(Buffer.from('original-image-data')),
        });
    });
    describe('AC5: CloudFront Resize - ?w=100 returns resized image', () => {
        it('?w=100を付与した場合、リサイズ処理が実行されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            expect(mockSharpInstance.resize).toHaveBeenCalledWith(100, undefined, expect.any(Object));
        });
        it('リサイズ後の画像がBase64エンコードで返されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(200);
            expect(result.isBase64Encoded).toBe(true);
            expect(result.headers?.['Content-Type']).toBe('image/webp');
        });
        it('幅と高さの両方が指定された場合、両方がresizeに渡されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100', h: '200' },
            });
            await (0, index_1.handler)(event);
            expect(mockSharpInstance.resize).toHaveBeenCalledWith(100, 200, expect.any(Object));
        });
        it('リサイズパラメータがない場合、302リダイレクトが返されること', async () => {
            const event = createEvent({
                queryStringParameters: {},
                rawQueryString: '',
            });
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(302);
            expect(result.headers?.Location).toContain('test-bucket');
        });
        it('キャッシュヘッダーが設定されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.headers?.['Cache-Control']).toBe('public, max-age=31536000');
        });
        it('S3からGetObjectCommandで元画像を取得すること', async () => {
            const { GetObjectCommand } = require('@aws-sdk/client-s3');
            const event = createEvent({
                queryStringParameters: { w: '100' },
            });
            await (0, index_1.handler)(event);
            expect(GetObjectCommand).toHaveBeenCalledWith({
                Bucket: 'test-bucket',
                Key: 'uploads/test-image.jpg',
            });
        });
        it('品質パラメータが指定された場合、webpに渡されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100', q: '90' },
            });
            await (0, index_1.handler)(event);
            expect(mockSharpInstance.webp).toHaveBeenCalledWith({ quality: 90 });
        });
        it('角丸パラメータが指定された場合、compositeが呼ばれること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100', r: '10' },
            });
            await (0, index_1.handler)(event);
            expect(mockSharpInstance.composite).toHaveBeenCalled();
        });
        it('角丸パラメータが指定された場合、デフォルトでPNG形式が返されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100', r: '10' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.headers?.['Content-Type']).toBe('image/png');
            expect(mockSharpInstance.png).toHaveBeenCalled();
        });
        it('フォーマットパラメータf=jpegが指定された場合、JPEG形式が返されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100', f: 'jpeg' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.headers?.['Content-Type']).toBe('image/jpeg');
            expect(mockSharpInstance.jpeg).toHaveBeenCalled();
        });
        it('フォーマットパラメータf=pngが指定された場合、PNG形式が返されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100', f: 'png' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.headers?.['Content-Type']).toBe('image/png');
            expect(mockSharpInstance.png).toHaveBeenCalled();
        });
        it('フォーマットパラメータf=webpが指定された場合、WebP形式が返されること', async () => {
            const event = createEvent({
                queryStringParameters: { w: '100', f: 'webp' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.headers?.['Content-Type']).toBe('image/webp');
            expect(mockSharpInstance.webp).toHaveBeenCalled();
        });
    });
    describe('Error Handling', () => {
        it('S3エラー時に500を返すこと', async () => {
            mockSend.mockRejectedValue(new Error('S3 Error'));
            const event = createEvent({
                queryStringParameters: { w: '100' },
            });
            const result = await (0, index_1.handler)(event);
            expect(result.statusCode).toBe(500);
            expect(JSON.parse(result.body)).toEqual({
                error: 'Image processing failed',
            });
        });
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW1hZ2UtcmVzaXplLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi90ZXN0L2xhbWJkYS9pbWFnZS1yZXNpemUudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUtBLGlCQUFpQjtBQUNqQixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUM1QyxJQUFJLEVBQUUsUUFBUTtLQUNmLENBQUMsQ0FBQztJQUNILGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDO0NBQ25FLENBQUMsQ0FBQyxDQUFDO0FBRUosYUFBYTtBQUNiLE1BQU0saUJBQWlCLEdBQUc7SUFDeEIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7SUFDbEMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7SUFDaEMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7SUFDL0IsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7SUFDaEMsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxjQUFjLEVBQUU7SUFDckMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7SUFDeEUsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIs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RTthQUMvQyxDQUFDLENBQUM7WUFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsZUFBTyxFQUFDLEtBQUssQ0FBc0MsQ0FBQztZQUV6RSxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzVELE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3BELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQixRQUFRLENBQUMsaUJBQWlCLENBQUMsSUFBSSxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUVsRCxNQUFNLEtBQUssR0FBRyxXQUFXLENBQUM7Z0JBQ3hCLHFCQUFxQixFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRTthQUNwQyxDQUFDLENBQUM7WUFFSCxNQUFNLE1BQU0sR0FBRyxNQUFNLElBQUEsZUFBTyxFQUFDLEtBQUssQ0FBc0MsQ0FBQztZQUV6RSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBYyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQ2hELEtBQUssRUFBRSx5QkFBeUI7YUFDakMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBQzU6IENsb3VkRnJvbnTjg6rjgrXjgqTjgrrjg4bjgrnjg4ggLSA/dz0xMDDjgpLku5jkuI7jgZfjgabjgqLjgq/jgrvjgrnjgZfjgZ/pmpvjgIHlhYPnlLvlg4/jgafjga/jgarjgY/jg6rjgrXjgqTjgrrnlLvlg4/jgYzov5TjgovjgZPjgahcbiAqL1xuaW1wb3J0IHsgQVBJR2F0ZXdheVByb3h5RXZlbnRWMiwgQVBJR2F0ZXdheVByb3h5U3RydWN0dXJlZFJlc3VsdFYyIH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5cbi8vIE1vY2sgUzMgQ2xpZW50XG5jb25zdCBtb2NrU2VuZCA9IGplc3QuZm4oKTtcbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LXMzJywgKCkgPT4gKHtcbiAgUzNDbGllbnQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBzZW5kOiBtb2NrU2VuZCxcbiAgfSkpLFxuICBHZXRPYmplY3RDb21tYW5kOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChwYXJhbXMpID0+IHBhcmFtcyksXG59KSk7XG5cbi8vIE1vY2sgc2hhcnBcbmNvbnN0IG1vY2tTaGFycEluc3RhbmNlID0ge1xuICByZXNpemU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICB3ZWJwOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgcG5nOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAganBlZzogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gIGNvbXBvc2l0ZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gIHRvQnVmZmVyOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoQnVmZmVyLmZyb20oJ3Jlc2l6ZWQtaW1hZ2UtZGF0YScpKSxcbiAgbWV0YWRhdGE6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHdpZHRoOiAxOTIwLCBoZWlnaHQ6IDEwODAgfSksXG59O1xuXG5qZXN0Lm1vY2soJ3NoYXJwJywgKCkgPT4ge1xuICByZXR1cm4gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiBtb2NrU2hhcnBJbnN0YW5jZSk7XG59KTtcblxuLy8gU2V0IGVudiBiZWZvcmUgaW1wb3J0aW5nIGhhbmRsZXJcbnByb2Nlc3MuZW52LkJVQ0tFVF9OQU1FID0gJ3Rlc3QtYnVja2V0JztcblxuLy8gSW1wb3J0IGhhbmRsZXIgYWZ0ZXIgbW9ja3NcbmltcG9ydCB7IGhhbmRsZXIgfSBmcm9tICcuLi8uLi9sYW1iZGEvaW1hZ2UtcmVzaXplL2luZGV4JztcblxuZGVzY3JpYmUoJ0ltYWdlIFJlc2l6ZSBMYW1iZGEnLCAoKSA9PiB7XG4gIGNvbnN0IGNyZWF0ZUV2ZW50ID0gKG92ZXJyaWRlczogUGFydGlhbDxBUElHYXRld2F5UHJveHlFdmVudFYyPiA9IHt9KTogQVBJR2F0ZXdheVByb3h5RXZlbnRWMiA9PiAoe1xuICAgIHZlcnNpb246ICcyLjAnLFxuICAgIHJvdXRlS2V5OiAnR0VUIC97cHJveHkrfScsXG4gICAgcmF3UGF0aDogJy91cGxvYWRzL3Rlc3QtaW1hZ2UuanBnJyxcbiAgICByYXdRdWVyeVN0cmluZzogJ3c9MTAwJyxcbiAgICBoZWFkZXJzOiB7fSxcbiAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IHtcbiAgICAgIHc6ICcxMDAnLFxuICAgIH0sXG4gICAgcGF0aFBhcmFtZXRlcnM6IHtcbiAgICAgIHByb3h5OiAndXBsb2Fkcy90ZXN0LWltYWdlLmpwZycsXG4gICAgfSxcbiAgICByZXF1ZXN0Q29udGV4dDoge1xuICAgICAgYWNjb3VudElkOiAnMTIzNDU2Nzg5MDEyJyxcbiAgICAgIGFwaUlkOiAndGVzdC1hcGktaWQnLFxuICAgICAgZG9tYWluTmFtZTogJ3Rlc3QuY2xvdWRmcm9udC5uZXQnLFxuICAgICAgZG9tYWluUHJlZml4OiAndGVzdCcsXG4gICAgICBodHRwOiB7XG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgIHBhdGg6ICcvdXBsb2Fkcy90ZXN0LWltYWdlLmpwZycsXG4gICAgICAgIHByb3RvY29sOiAnSFRUUC8xLjEnLFxuICAgICAgICBzb3VyY2VJcDogJzEyNy4wLjAuMScsXG4gICAgICAgIHVzZXJBZ2VudDogJ3Rlc3QtYWdlbnQnLFxuICAgICAgfSxcbiAgICAgIHJlcXVlc3RJZDogJ3Rlc3QtcmVxdWVzdC1pZCcsXG4gICAgICByb3V0ZUtleTogJ0dFVCAve3Byb3h5K30nLFxuICAgICAgc3RhZ2U6ICckZGVmYXVsdCcsXG4gICAgICB0aW1lOiAnMDEvSmFuLzIwMjQ6MDA6MDA6MDAgKzAwMDAnLFxuICAgICAgdGltZUVwb2NoOiAxNzA0MDY3MjAwMDAwLFxuICAgIH0sXG4gICAgaXNCYXNlNjRFbmNvZGVkOiBmYWxzZSxcbiAgICAuLi5vdmVycmlkZXMsXG4gIH0pO1xuXG4gIC8vIEhlbHBlciB0byBjcmVhdGUgYSByZWFkYWJsZSBzdHJlYW0gZnJvbSBidWZmZXJcbiAgY29uc3QgY3JlYXRlTW9ja1N0cmVhbSA9IChkYXRhOiBCdWZmZXIpID0+IHtcbiAgICBjb25zdCB7IFJlYWRhYmxlIH0gPSByZXF1aXJlKCdzdHJlYW0nKTtcbiAgICByZXR1cm4gUmVhZGFibGUuZnJvbShbZGF0YV0pO1xuICB9O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIC8vIFJlc2V0IG1vY2sgUzMgcmVzcG9uc2VcbiAgICBtb2NrU2VuZC5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBCb2R5OiBjcmVhdGVNb2NrU3RyZWFtKEJ1ZmZlci5mcm9tKCdvcmlnaW5hbC1pbWFnZS1kYXRhJykpLFxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQUM1OiBDbG91ZEZyb250IFJlc2l6ZSAtID93PTEwMCByZXR1cm5zIHJlc2l6ZWQgaW1hZ2UnLCAoKSA9PiB7XG4gICAgaXQoJz93PTEwMOOCkuS7mOS4juOBl+OBn+WgtOWQiOOAgeODquOCteOCpOOCuuWHpueQhuOBjOWun+ihjOOBleOCjOOCi+OBk+OBqCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlRXZlbnQoe1xuICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IHsgdzogJzEwMCcgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KSBhcyBBUElHYXRld2F5UHJveHlTdHJ1Y3R1cmVkUmVzdWx0VjI7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KG1vY2tTaGFycEluc3RhbmNlLnJlc2l6ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoMTAwLCB1bmRlZmluZWQsIGV4cGVjdC5hbnkoT2JqZWN0KSk7XG4gICAgfSk7XG5cbiAgICBpdCgn44Oq44K144Kk44K65b6M44Gu55S75YOP44GMQmFzZTY044Ko44Oz44Kz44O844OJ44Gn6L+U44GV44KM44KL44GT44GoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVFdmVudCh7XG4gICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyB3OiAnMTAwJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIoZXZlbnQpIGFzIEFQSUdhdGV3YXlQcm94eVN0cnVjdHVyZWRSZXN1bHRWMjtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXNDb2RlKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmlzQmFzZTY0RW5jb2RlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaGVhZGVycz8uWydDb250ZW50LVR5cGUnXSkudG9CZSgnaW1hZ2Uvd2VicCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+W5heOBqOmrmOOBleOBruS4oeaWueOBjOaMh+WumuOBleOCjOOBn+WgtOWQiOOAgeS4oeaWueOBjHJlc2l6ZeOBq+a4oeOBleOCjOOCi+OBk+OBqCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlRXZlbnQoe1xuICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IHsgdzogJzEwMCcsIGg6ICcyMDAnIH0sXG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgaGFuZGxlcihldmVudCk7XG5cbiAgICAgIGV4cGVjdChtb2NrU2hhcnBJbnN0YW5jZS5yZXNpemUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKDEwMCwgMjAwLCBleHBlY3QuYW55KE9iamVjdCkpO1xuICAgIH0pO1xuXG4gICAgaXQoJ+ODquOCteOCpOOCuuODkeODqeODoeODvOOCv+OBjOOBquOBhOWgtOWQiOOAgTMwMuODquODgOOCpOODrOOCr+ODiOOBjOi/lOOBleOCjOOCi+OBk+OBqCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlRXZlbnQoe1xuICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IHt9LFxuICAgICAgICByYXdRdWVyeVN0cmluZzogJycsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5U3RydWN0dXJlZFJlc3VsdFYyO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMzAyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaGVhZGVycz8uTG9jYXRpb24pLnRvQ29udGFpbigndGVzdC1idWNrZXQnKTtcbiAgICB9KTtcblxuICAgIGl0KCfjgq3jg6Pjg4Pjgrfjg6Xjg5jjg4Pjg4Djg7zjgYzoqK3lrprjgZXjgozjgovjgZPjgagnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZUV2ZW50KHtcbiAgICAgICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiB7IHc6ICcxMDAnIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5U3RydWN0dXJlZFJlc3VsdFYyO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnM/LlsnQ2FjaGUtQ29udHJvbCddKS50b0JlKCdwdWJsaWMsIG1heC1hZ2U9MzE1MzYwMDAnKTtcbiAgICB9KTtcblxuICAgIGl0KCdTM+OBi+OCiUdldE9iamVjdENvbW1hbmTjgaflhYPnlLvlg4/jgpLlj5blvpfjgZnjgovjgZPjgagnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB7IEdldE9iamVjdENvbW1hbmQgfSA9IHJlcXVpcmUoJ0Bhd3Mtc2RrL2NsaWVudC1zMycpO1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVFdmVudCh7XG4gICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyB3OiAnMTAwJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZXIoZXZlbnQpO1xuXG4gICAgICBleHBlY3QoR2V0T2JqZWN0Q29tbWFuZCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBCdWNrZXQ6ICd0ZXN0LWJ1Y2tldCcsXG4gICAgICAgIEtleTogJ3VwbG9hZHMvdGVzdC1pbWFnZS5qcGcnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgn5ZOB6LOq44OR44Op44Oh44O844K/44GM5oyH5a6a44GV44KM44Gf5aC05ZCI44CBd2VicOOBq+a4oeOBleOCjOOCi+OBk+OBqCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gY3JlYXRlRXZlbnQoe1xuICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnM6IHsgdzogJzEwMCcsIHE6ICc5MCcgfSxcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcblxuICAgICAgZXhwZWN0KG1vY2tTaGFycEluc3RhbmNlLndlYnApLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHsgcXVhbGl0eTogOTAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgn6KeS5Li444OR44Op44Oh44O844K/44GM5oyH5a6a44GV44KM44Gf5aC05ZCI44CBY29tcG9zaXRl44GM5ZG844Gw44KM44KL44GT44GoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVFdmVudCh7XG4gICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyB3OiAnMTAwJywgcjogJzEwJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGhhbmRsZXIoZXZlbnQpO1xuXG4gICAgICBleHBlY3QobW9ja1NoYXJwSW5zdGFuY2UuY29tcG9zaXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgn6KeS5Li444OR44Op44Oh44O844K/44GM5oyH5a6a44GV44KM44Gf5aC05ZCI44CB44OH44OV44Kp44Or44OI44GnUE5H5b2i5byP44GM6L+U44GV44KM44KL44GT44GoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVFdmVudCh7XG4gICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyB3OiAnMTAwJywgcjogJzEwJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIoZXZlbnQpIGFzIEFQSUdhdGV3YXlQcm94eVN0cnVjdHVyZWRSZXN1bHRWMjtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5oZWFkZXJzPy5bJ0NvbnRlbnQtVHlwZSddKS50b0JlKCdpbWFnZS9wbmcnKTtcbiAgICAgIGV4cGVjdChtb2NrU2hhcnBJbnN0YW5jZS5wbmcpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCfjg5Xjgqnjg7zjg57jg4Pjg4jjg5Hjg6njg6Hjg7zjgr9mPWpwZWfjgYzmjIflrprjgZXjgozjgZ/loLTlkIjjgIFKUEVH5b2i5byP44GM6L+U44GV44KM44KL44GT44GoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVFdmVudCh7XG4gICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyB3OiAnMTAwJywgZjogJ2pwZWcnIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5U3RydWN0dXJlZFJlc3VsdFYyO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnM/LlsnQ29udGVudC1UeXBlJ10pLnRvQmUoJ2ltYWdlL2pwZWcnKTtcbiAgICAgIGV4cGVjdChtb2NrU2hhcnBJbnN0YW5jZS5qcGVnKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgn44OV44Kp44O844Oe44OD44OI44OR44Op44Oh44O844K/Zj1wbmfjgYzmjIflrprjgZXjgozjgZ/loLTlkIjjgIFQTkflvaLlvI/jgYzov5TjgZXjgozjgovjgZPjgagnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZUV2ZW50KHtcbiAgICAgICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiB7IHc6ICcxMDAnLCBmOiAncG5nJyB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGhhbmRsZXIoZXZlbnQpIGFzIEFQSUdhdGV3YXlQcm94eVN0cnVjdHVyZWRSZXN1bHRWMjtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5oZWFkZXJzPy5bJ0NvbnRlbnQtVHlwZSddKS50b0JlKCdpbWFnZS9wbmcnKTtcbiAgICAgIGV4cGVjdChtb2NrU2hhcnBJbnN0YW5jZS5wbmcpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCfjg5Xjgqnjg7zjg57jg4Pjg4jjg5Hjg6njg6Hjg7zjgr9mPXdlYnDjgYzmjIflrprjgZXjgozjgZ/loLTlkIjjgIFXZWJQ5b2i5byP44GM6L+U44GV44KM44KL44GT44GoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXZlbnQgPSBjcmVhdGVFdmVudCh7XG4gICAgICAgIHF1ZXJ5U3RyaW5nUGFyYW1ldGVyczogeyB3OiAnMTAwJywgZjogJ3dlYnAnIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5U3RydWN0dXJlZFJlc3VsdFYyO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmhlYWRlcnM/LlsnQ29udGVudC1UeXBlJ10pLnRvQmUoJ2ltYWdlL3dlYnAnKTtcbiAgICAgIGV4cGVjdChtb2NrU2hhcnBJbnN0YW5jZS53ZWJwKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnUzPjgqjjg6njg7zmmYLjgas1MDDjgpLov5TjgZnjgZPjgagnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrU2VuZC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoJ1MzIEVycm9yJykpO1xuXG4gICAgICBjb25zdCBldmVudCA9IGNyZWF0ZUV2ZW50KHtcbiAgICAgICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzOiB7IHc6ICcxMDAnIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCkgYXMgQVBJR2F0ZXdheVByb3h5U3RydWN0dXJlZFJlc3VsdFYyO1xuXG4gICAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNTAwKTtcbiAgICAgIGV4cGVjdChKU09OLnBhcnNlKHJlc3VsdC5ib2R5IGFzIHN0cmluZykpLnRvRXF1YWwoe1xuICAgICAgICBlcnJvcjogJ0ltYWdlIHByb2Nlc3NpbmcgZmFpbGVkJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl19