{"version":3,"sources":["../src/utils/imageCompression.ts","../src/components/ImageCropper.tsx","../src/components/S3Uploader.tsx"],"names":["imageCompression","useState","useRef","useCallback","jsxs","jsx","ReactCrop"],"mappings":"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","file":"index.cjs","sourcesContent":["import imageCompression from 'browser-image-compression';\n\nexport interface CompressionOptions {\n  maxSizeMB?: number;\n  maxWidthOrHeight?: number;\n  useWebWorker?: boolean;\n}\n\nconst DEFAULT_OPTIONS: CompressionOptions = {\n  maxSizeMB: 2,\n  maxWidthOrHeight: 1920,\n  useWebWorker: true,\n};\n\nconst ALLOWED_TYPES = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\n\nexport async function compressImage(\n  file: File,\n  options: CompressionOptions = {}\n): Promise<File> {\n  // Validate file type\n  if (!ALLOWED_TYPES.includes(file.type)) {\n    throw new Error('Invalid file type. Allowed types: JPEG, PNG, GIF, WebP');\n  }\n\n  const mergedOptions = { ...DEFAULT_OPTIONS, ...options };\n  const maxSizeBytes = (mergedOptions.maxSizeMB || 2) * 1024 * 1024;\n\n  // If file is already under the threshold, return as-is\n  if (file.size <= maxSizeBytes) {\n    return file;\n  }\n\n  // Compress the image\n  const compressedFile = await imageCompression(file, {\n    maxSizeMB: mergedOptions.maxSizeMB,\n    maxWidthOrHeight: mergedOptions.maxWidthOrHeight,\n    useWebWorker: mergedOptions.useWebWorker,\n  });\n\n  return compressedFile;\n}\n","import { useState, useRef, useCallback } from 'react';\nimport ReactCrop, { Crop, PixelCrop } from 'react-image-crop';\nimport 'react-image-crop/dist/ReactCrop.css';\n\nexport interface ImageCropperProps {\n  src: string;\n  onCropComplete: (croppedImageBlob: Blob) => void;\n  onCancel: () => void;\n  aspectRatio?: number;\n}\n\nexport function ImageCropper({\n  src,\n  onCropComplete,\n  onCancel,\n  aspectRatio,\n}: ImageCropperProps) {\n  const [crop, setCrop] = useState<Crop>({\n    unit: '%',\n    x: 10,\n    y: 10,\n    width: 80,\n    height: 80,\n  });\n  const [completedCrop, setCompletedCrop] = useState<PixelCrop | null>(null);\n  const imgRef = useRef<HTMLImageElement>(null);\n\n  const handleCropChange = useCallback((c: Crop) => {\n    setCrop(c);\n  }, []);\n\n  const handleCropComplete = useCallback((c: PixelCrop) => {\n    setCompletedCrop(c);\n  }, []);\n\n  const getCroppedImage = useCallback(async (): Promise<Blob | null> => {\n    if (!completedCrop || !imgRef.current) {\n      return null;\n    }\n\n    const image = imgRef.current;\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n\n    if (!ctx) {\n      return null;\n    }\n\n    const scaleX = image.naturalWidth / image.width;\n    const scaleY = image.naturalHeight / image.height;\n\n    canvas.width = completedCrop.width;\n    canvas.height = completedCrop.height;\n\n    ctx.drawImage(\n      image,\n      completedCrop.x * scaleX,\n      completedCrop.y * scaleY,\n      completedCrop.width * scaleX,\n      completedCrop.height * scaleY,\n      0,\n      0,\n      completedCrop.width,\n      completedCrop.height\n    );\n\n    return new Promise((resolve) => {\n      canvas.toBlob(\n        (blob) => {\n          resolve(blob);\n        },\n        'image/jpeg',\n        0.95\n      );\n    });\n  }, [completedCrop]);\n\n  const handleConfirm = useCallback(async () => {\n    const croppedBlob = await getCroppedImage();\n    if (croppedBlob) {\n      onCropComplete(croppedBlob);\n    }\n  }, [getCroppedImage, onCropComplete]);\n\n  return (\n    <div className=\"image-cropper\">\n      <div className=\"image-cropper__container\">\n        <ReactCrop\n          crop={crop}\n          onChange={handleCropChange}\n          onComplete={handleCropComplete}\n          aspect={aspectRatio}\n        >\n          <img\n            ref={imgRef}\n            src={src}\n            alt=\"Crop preview\"\n            style={{ maxWidth: '100%', maxHeight: '70vh' }}\n          />\n        </ReactCrop>\n      </div>\n      <div className=\"image-cropper__actions\">\n        <button\n          type=\"button\"\n          onClick={onCancel}\n          className=\"image-cropper__button image-cropper__button--cancel\"\n        >\n          Cancel\n        </button>\n        <button\n          type=\"button\"\n          onClick={handleConfirm}\n          className=\"image-cropper__button image-cropper__button--confirm\"\n        >\n          Crop\n        </button>\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useCallback, useRef } from 'react';\nimport { compressImage } from '../utils/imageCompression';\nimport { ImageCropper } from './ImageCropper';\nimport type { S3UploaderProps, PresignedUrlResponse } from '../types';\n\ntype UploadStatus = 'idle' | 'compressing' | 'cropping' | 'uploading' | 'success' | 'error';\n\nexport function S3Uploader({\n  apiEndpoint,\n  apiKey,\n  onUploadComplete,\n  onUploadError,\n  onProgress,\n  maxFileSizeMB = 10,\n  allowedFileTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],\n  enableCrop = false,\n  enableCompression = true,\n  compressionOptions = { maxSizeMB: 2, maxWidthOrHeight: 1920 },\n}: S3UploaderProps) {\n  const [selectedFile, setSelectedFile] = useState<File | null>(null);\n  const [previewUrl, setPreviewUrl] = useState<string | null>(null);\n  const [status, setStatus] = useState<UploadStatus>('idle');\n  const [progress, setProgress] = useState(0);\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  const [showCropper, setShowCropper] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = useCallback(\n    async (event: React.ChangeEvent<HTMLInputElement>) => {\n      const file = event.target.files?.[0];\n      if (!file) return;\n\n      // Validate file type\n      if (!allowedFileTypes.includes(file.type)) {\n        setErrorMessage(`Invalid file type. Allowed: ${allowedFileTypes.join(', ')}`);\n        return;\n      }\n\n      // Validate file size\n      if (file.size > maxFileSizeMB * 1024 * 1024) {\n        setErrorMessage(`File too large. Maximum size: ${maxFileSizeMB}MB`);\n        return;\n      }\n\n      setSelectedFile(file);\n      setErrorMessage(null);\n\n      // Create preview URL\n      const url = URL.createObjectURL(file);\n      setPreviewUrl(url);\n\n      // Show cropper if enabled\n      if (enableCrop) {\n        setShowCropper(true);\n      }\n    },\n    [allowedFileTypes, maxFileSizeMB, enableCrop]\n  );\n\n  const handleCropComplete = useCallback((croppedBlob: Blob) => {\n    const croppedFile = new File([croppedBlob], selectedFile?.name || 'cropped.jpg', {\n      type: 'image/jpeg',\n    });\n    setSelectedFile(croppedFile);\n    setPreviewUrl(URL.createObjectURL(croppedBlob));\n    setShowCropper(false);\n  }, [selectedFile]);\n\n  const handleCropCancel = useCallback(() => {\n    setShowCropper(false);\n  }, []);\n\n  const getPresignedUrl = async (fileName: string, contentType: string): Promise<PresignedUrlResponse> => {\n    const response = await fetch(`${apiEndpoint}/presigned-url`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Api-Key': apiKey,\n      },\n      body: JSON.stringify({ fileName, contentType }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to get presigned URL: ${response.status}`);\n    }\n\n    return response.json();\n  };\n\n  const uploadToS3 = async (uploadUrl: string, file: File): Promise<void> => {\n    const response = await fetch(uploadUrl, {\n      method: 'PUT',\n      headers: {\n        'Content-Type': file.type,\n      },\n      body: file,\n    });\n\n    if (!response.ok) {\n      throw new Error(`Upload failed: ${response.status}`);\n    }\n  };\n\n  const handleUpload = useCallback(async () => {\n    if (!selectedFile) return;\n\n    try {\n      setStatus('compressing');\n      setProgress(10);\n      onProgress?.(10);\n\n      // Compress image if enabled\n      let fileToUpload = selectedFile;\n      if (enableCompression && selectedFile.type.startsWith('image/')) {\n        fileToUpload = await compressImage(selectedFile, compressionOptions);\n      }\n\n      setStatus('uploading');\n      setProgress(30);\n      onProgress?.(30);\n\n      // Get presigned URL\n      const { uploadUrl, fileUrl } = await getPresignedUrl(\n        fileToUpload.name,\n        fileToUpload.type\n      );\n\n      setProgress(50);\n      onProgress?.(50);\n\n      // Upload to S3\n      await uploadToS3(uploadUrl, fileToUpload);\n\n      setProgress(100);\n      onProgress?.(100);\n      setStatus('success');\n\n      onUploadComplete?.(fileUrl);\n    } catch (error) {\n      setStatus('error');\n      const errorObj = error instanceof Error ? error : new Error('Unknown error');\n      setErrorMessage(errorObj.message);\n      onUploadError?.(errorObj);\n    }\n  }, [\n    selectedFile,\n    enableCompression,\n    compressionOptions,\n    apiEndpoint,\n    apiKey,\n    onUploadComplete,\n    onUploadError,\n    onProgress,\n  ]);\n\n  const handleReset = useCallback(() => {\n    setSelectedFile(null);\n    setPreviewUrl(null);\n    setStatus('idle');\n    setProgress(0);\n    setErrorMessage(null);\n    setShowCropper(false);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  }, []);\n\n  if (showCropper && previewUrl) {\n    return (\n      <ImageCropper\n        src={previewUrl}\n        onCropComplete={handleCropComplete}\n        onCancel={handleCropCancel}\n      />\n    );\n  }\n\n  return (\n    <div className=\"s3-uploader\">\n      <div className=\"s3-uploader__input-container\">\n        <label htmlFor=\"file-input\" className=\"s3-uploader__label\">\n          Select File\n        </label>\n        <input\n          ref={fileInputRef}\n          id=\"file-input\"\n          type=\"file\"\n          accept=\"image/*\"\n          onChange={handleFileSelect}\n          className=\"s3-uploader__input\"\n          disabled={status === 'uploading' || status === 'compressing'}\n        />\n      </div>\n\n      {previewUrl && !showCropper && (\n        <div className=\"s3-uploader__preview\">\n          <img\n            src={previewUrl}\n            alt=\"Preview\"\n            className=\"s3-uploader__preview-image\"\n            style={{ maxWidth: '200px', maxHeight: '200px' }}\n          />\n        </div>\n      )}\n\n      {errorMessage && (\n        <div className=\"s3-uploader__error\" role=\"alert\">\n          {errorMessage}\n        </div>\n      )}\n\n      {status === 'uploading' || status === 'compressing' ? (\n        <div className=\"s3-uploader__progress\">\n          <progress\n            value={progress}\n            max={100}\n            className=\"s3-uploader__progress-bar\"\n            role=\"progressbar\"\n            aria-valuenow={progress}\n            aria-valuemin={0}\n            aria-valuemax={100}\n          />\n          <span className=\"s3-uploader__progress-text\">{progress}%</span>\n        </div>\n      ) : null}\n\n      {status === 'success' && (\n        <div className=\"s3-uploader__success\" role=\"status\">\n          Upload complete!\n        </div>\n      )}\n\n      <div className=\"s3-uploader__actions\">\n        <button\n          type=\"button\"\n          onClick={handleUpload}\n          disabled={!selectedFile || status === 'uploading' || status === 'compressing'}\n          className=\"s3-uploader__button s3-uploader__button--upload\"\n        >\n          Upload\n        </button>\n        {(selectedFile || status === 'success' || status === 'error') && (\n          <button\n            type=\"button\"\n            onClick={handleReset}\n            className=\"s3-uploader__button s3-uploader__button--reset\"\n          >\n            Reset\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n"]}